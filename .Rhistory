df_genes <- df_genes %>%
mutate(status =
ifelse(scn1a == TRUE, "scn1a",
ifelse(cdkl5 == TRUE, "cdkl5",
ifelse(GENEPOS_comb == "N", "nongenetic",
ifelse(GENEPOS_comb == "Y", "genetic",
NA))))) %>%
select(PatientId, ConceptID, ContactAge, ProcAge, status)
hpo_map
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
df_genes_mapped
# define positive group
df_genes_mapped <- df_genes_mapped %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
res$plot
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(Surgery %in% c("scn1a",
"nongenetic")) %>%
mutate(group = status == "scn1a")
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"nongenetic")) %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
res$plot
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
res$plot
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# propagate
df_genes_mapped <- left_join(df_genes_mapped, prop_map, by = "ConceptID")
head(prop_map)
# propagate
df_genes_mapped <- left_join(df_genes_mapped, prop_map, by = "term")
df_genes_mapped
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
unlist()
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
unlist(recursive = F)
# propagate
left_join(df_genes_mapped, prop_map, by = "term")
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
.$prop_terms %>%
unlist() %>%
unique()
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
.$prop_terms %>%
unlist()
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unlist()
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unnest()
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unnest(cols = c(prop_terms))
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unnest(cols = c(prop_terms))
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
res$plot
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
view(res$data)
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unnest(cols = c(prop_terms))
# map to HPO and propagate
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit %>%
left_join(prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unnest(cols = c(prop_terms))
# define comparison groups and positive group, then plot
res <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a") %>%
enrichmentPlot(., ont_hpo)
df_genes_mapped
# map to HPO and propagate
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit %>%
left_join(prop_map, by = "term") %>%
select(PatientId, prop_terms, status) %>%
unnest(cols = c(prop_terms))
# define comparison groups and positive group, then plot
res <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a") %>%
enrichmentPlot(., ont_hpo)
df_genes_mapped
# map to HPO and propagate
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit %>%
left_join(prop_map, by = "term") %>%
select(PatientId, prop_terms, status) %>%
rename(term = prop_terms) %>%
unnest(cols = c(term))
# define comparison groups and positive group, then plot
res <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# propagate
left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unnest(cols = c(prop_terms))
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# propagate
df_genes_mapped <- left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unnest(cols = c(prop_terms))
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# propagate
df_genes_mapped <- left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms) %>%
unnest(cols = c(prop_terms)) %>%
rename(term = prop_terms)
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# propagate
df_genes_mapped <- left_join(df_genes_mapped, prop_map, by = "term") %>%
select(PatientId, prop_terms, status) %>%
unnest(cols = c(prop_terms)) %>%
rename(term = prop_terms)
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# define comparison groups and positive group
df_genes_mapped <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a")
# run fn
res <- enrichmentPlot(df_genes_mapped, ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# define comparison groups and positive group
res <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# CDKL5
res <- df_genes_mapped %>%
filter(status %in% c("cdkl5",
"genetic")) %>%
mutate(group = status == "cdkl5") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("CDKL5 vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 1), ylim = c(0, 1)) +
ggtitle("CDKL5 vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# map to HPO
df_genes_mapped <- left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
left_join(prop_map, by = "term") %>%
rename(term = prop_terms) %>%
na.omit
left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
left_join(prop_map, by = "term")
left_join(df_genes, hpo_map, by = "ConceptID") %>%
rename(term = name)
hpo_map
df_genes
# preprocessing as above
df_genes <- df_raw %>%
mutate(cdkl5 = .$MedicalRecordNumber %in% df_cdkl5$MRN) %>%
mutate(scn1a = .$MedicalRecordNumber %in% df_scn1a$PAT_MRN_ID) %>%
select(PatientId, # patient ID
ConceptID, # UMLS code for encounter
GENEPOS_comb, # binary vector: non-genetic vs likely genetic patient
ContactAge, # relative age at encounter
ProcAge, # age at epilepsy CPT
cdkl5, # bool, cdkl5?
scn1a # bool, scn1a?
) %>%
group_by(PatientId) %>%
arrange(desc(ContactAge)) %>%
fill(ContactAge, .direction = c("up")) %>%
na.omit
# fix group column
df_genes <- df_genes %>%
mutate(status =
ifelse(scn1a == TRUE, "scn1a",
ifelse(cdkl5 == TRUE, "cdkl5",
ifelse(GENEPOS_comb == "N", "nongenetic",
ifelse(GENEPOS_comb == "Y", "genetic",
NA))))) %>%
select(PatientId, ConceptID, ContactAge, ProcAge, status)
left_join(df_genes, hpo_map, by = "ConceptID")
df_genes
hpo_map
left_join(df_genes, hpo_map, by = "ConceptID")
df_genes %>%
ungroup() %>%
left_join(., hpo_map, by = "ConceptID")
hpo_map
df_genes %>%
left_join(hpo_map, by = "ConceptID")
tmp <- df_genes %>%
left_join(hpo_map, by = "ConceptID")
table(tmp$name)
# map to HPO
df_genes_mapped <- df_genes %>%
left_join(hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
left_join(prop_map, by = "term") %>%
rename(term = prop_terms) %>%
na.omit
df_genes %>%
left_join(hpo_map, by = "ConceptID") %>%
rename(term = name)
prop_map
df_genes %>%
left_join(hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
left_join(prop_map, by = "term")
df_genes %>%
left_join(hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
left_join(prop_map, by = "term") %>%
select(-term) %>%
rename(term = prop_terms)
df_genes %>%
left_join(hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
left_join(prop_map, by = "term") %>%
select(-term) %>%
rename(term = prop_terms) %>%
na.omit %>%
unnest()
# map to HPO and propagate
df_genes_mapped <- df_genes %>%
left_join(hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
left_join(prop_map, by = "term") %>%
select(-term) %>%
rename(term = prop_terms) %>%
na.omit %>%
unnest(cols = c(term))
# SCN1A
res <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 0.33), ylim = c(0, 0.33)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 0.25), ylim = c(0, 0.25)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 0.25), ylim = c(0, 0.2)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 0.25), ylim = c(0, 0.15)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# CDKL5
res <- df_genes_mapped %>%
filter(status %in% c("cdkl5",
"genetic")) %>%
mutate(group = status == "cdkl5") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 1), ylim = c(0, 1)) +
ggtitle("CDKL5 vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, .33), ylim = c(0, .33)) +
ggtitle("CDKL5 vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# may also choose not to propagate to keep a clear signal
df_genes_mapped <- df_genes %>%
left_join(hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
na.omit
# SCN1A
res <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.25), ylim = c(0, 0.25)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# CDKL5
res <- df_genes_mapped %>%
filter(status %in% c("cdkl5",
"genetic")) %>%
mutate(group = status == "cdkl5") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 1), ylim = c(0, 1)) +
ggtitle("CDKL5 vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
# map to HPO and propagate
df_genes_mapped <- df_genes %>%
left_join(hpo_map, by = "ConceptID") %>%
rename(term = name) %>%
left_join(prop_map, by = "term") %>%
select(-term) %>%
rename(term = prop_terms) %>%
na.omit %>%
unnest(cols = c(term))
# SCN1A
res <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 0.8), ylim = c(0, 0.8)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 0.25), ylim = c(0, 0.25)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, 0.4), ylim = c(0, 0.4)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
view(res$data)
# CDKL5
res <- df_genes_mapped %>%
filter(status %in% c("cdkl5",
"genetic")) %>%
mutate(group = status == "cdkl5") %>%
enrichmentPlot(., ont_hpo)
res$plot +
coord_fixed(xlim = c(0, 1), ylim = c(0, 1)) +
ggtitle("CDKL5 vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
res$plot +
coord_fixed(xlim = c(0, .33), ylim = c(0, .33)) +
ggtitle("CDKL5 vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
view(res$data)
head(df_raw)
head(df_genes)
table(df_genes$status)
head(df_genes_mapped)
nrow(df_genes_mapped)
head(res$data)
df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a")
# SCN1A
res <- df_genes_mapped %>%
filter(status %in% c("scn1a",
"genetic")) %>%
mutate(group = status == "scn1a") %>%
enrichmentPlot(., ont_hpo)
res$plot
res$plot +
coord_fixed(xlim = c(0, 0.4), ylim = c(0, 0.4)) +
ggtitle("SCN1A vs Genetic") +
theme(plot.title = element_text(hjust = 0.5))
