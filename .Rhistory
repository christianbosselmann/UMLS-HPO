# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "gray",
vertex.label.color = "black",
vertex.label.cex = 0.8,
vertex.label.dist = 2.5,
edge.arrow.size = .2,
layout = layout_as_tree)))
pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
pqg
V(g2)[vec_min]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\n", "\n", df_desc$description)
V(g2)["HP:0003244"]$label <- paste0("\n","\n","\n","\n", "\n", "\n", "\n", "\n", "\t","Penile hypospadia")
V(g2)["HP:0000028"]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\t","Cryptorchidism")
V(g2)$color <- "gray"
V(g2)[vec_min]$color <- "tomato"
V(g2)$size <- 5
V(g2)[vec_min]$size <- -log10(df_desc$pvalue) + 5
E(g2)$arrow.mode <- 2
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "gray",
vertex.label.color = "black",
vertex.label.cex = 0.8,
vertex.label.dist = 2.5,
edge.arrow.size = .2,
layout = layout_as_tree)))
pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
V(g2)
vec_min
df_desc
g2 <- as.igraph(graph_hpo)
V(g2)$label <- NA
V(g2)[vec_min]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\n", "\n", df_desc$description)
V(g2)["HP:0003244"]$label <- paste0("\n","\n","\n","\n","\n", "\n", "\n", "\n", "\n", "\t","Penile hypospadia")
V(g2)["HP:0000028"]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\t","Cryptorchidism")
V(g2)["HP:0000086"]$label <- paste0("\n", "\n", "\t","Ectopic kidney")
V(g2)$color <- "gray"
V(g2)[vec_min]$color <- "tomato"
V(g2)$size <- 5
V(g2)[vec_min]$size <- -log10(df_desc$pvalue) + 5
E(g2)$arrow.mode <- 2
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "gray",
vertex.label.color = "black",
vertex.label.cex = 0.8,
vertex.label.dist = 2.5,
edge.arrow.size = .2,
layout = layout_as_tree)))
pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
pqg
pqg <- pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
pqg
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8)
Fig2
dev.off()
V(g2)$label
V(g2)[vec_min]$label
rep(LETTERS)
rep(LETTERS, V(g2)[vec_min]$label)
rep(LETTERS, length(V(g2)[vec_min]$label))
rep(LETTERS, 1:length(V(g2)[vec_min]$label))
length(V(g2)[vec_min]$label)
rep(LETTER)[1:length(V(g2)[vec_min]$label)]
rep(LETTERS)[1:length(V(g2)[vec_min]$label)]
## note: complete term name labels are just impossible to format with igraph
# V(g2)$label <- NA
# V(g2)[vec_min]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\n", "\n", df_desc$description)
# V(g2)["HP:0003244"]$label <- paste0("\n","\n","\n","\n","\n", "\n", "\n", "\n", "\n", "\t","Penile hypospadia")
# V(g2)["HP:0000028"]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\t","Cryptorchidism")
# V(g2)["HP:0000086"]$label <- paste0("\n", "\n", "\t","Ectopic kidney")
V(g2)$label <- NA
V(g2)[vec_min]$label <- rep(LETTERS)[1:length(V(g2)[vec_min]$label)]
V(g2)$color <- "gray"
V(g2)[vec_min]$color <- "tomato"
V(g2)$size <- 5
V(g2)[vec_min]$size <- -log10(df_desc$pvalue) + 5
E(g2)$arrow.mode <- 2
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "gray",
vertex.label.color = "black",
vertex.label.cex = 0.8,
vertex.label.dist = 2.5,
edge.arrow.size = .2,
layout = layout_as_tree)))
pqg <- pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
pqg
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8)
Fig2
dev.off()
# revert to igraph and format graph
g2 <- as.igraph(graph_hpo)
## note: complete term name labels are just impossible to format with igraph
# V(g2)$label <- NA
# V(g2)[vec_min]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\n", "\n", df_desc$description)
# V(g2)["HP:0003244"]$label <- paste0("\n","\n","\n","\n","\n", "\n", "\n", "\n", "\n", "\t","Penile hypospadia")
# V(g2)["HP:0000028"]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\t","Cryptorchidism")
# V(g2)["HP:0000086"]$label <- paste0("\n", "\n", "\t","Ectopic kidney")
V(g2)$label <- NA
V(g2)[vec_min]$label <- rep(LETTERS)[1:length(V(g2)[vec_min]$label)]
V(g2)$color <- "gray"
V(g2)[vec_min]$color <- "tomato"
V(g2)$size <- 5
V(g2)[vec_min]$size <- -log10(df_desc$pvalue) + 5
E(g2)$arrow.mode <- 2
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "gray",
vertex.label.color = "black",
vertex.label.cex = 0.8,
# vertex.label.dist = 2.5,
edge.arrow.size = .2,
layout = layout_as_tree)))
pqg <- pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8)
Fig2
dev.off()
# revert to igraph and format graph
g2 <- as.igraph(graph_hpo)
## note: complete term name labels are just impossible to format with igraph
# V(g2)$label <- NA
# V(g2)[vec_min]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\n", "\n", df_desc$description)
# V(g2)["HP:0003244"]$label <- paste0("\n","\n","\n","\n","\n", "\n", "\n", "\n", "\n", "\t","Penile hypospadia")
# V(g2)["HP:0000028"]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\t","Cryptorchidism")
# V(g2)["HP:0000086"]$label <- paste0("\n", "\n", "\t","Ectopic kidney")
V(g2)$label <- NA
V(g2)[vec_min]$label <- rep(LETTERS)[1:length(V(g2)[vec_min]$label)]
V(g2)$color <- "gray"
V(g2)[vec_min]$color <- "tomato"
V(g2)$size <- 7
V(g2)[vec_min]$size <- -log10(df_desc$pvalue) + 7
E(g2)$arrow.mode <- 2
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "gray",
vertex.label.color = "black",
vertex.label.cex = 0.8,
# vertex.label.dist = 2.5,
edge.arrow.size = .2,
layout = layout_as_tree)))
pqg <- pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8)
Fig2
dev.off()
pdf.options(encoding='ISOLatin2.enc')
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8)
Fig2
dev.off()
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "hv")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8)
Fig2
dev.off()
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8)
Fig2
dev.off()
view(enrich1$plot$data)
enrich1$plot
view(enrich1$plot$data %>% filter(pvalue < 0.05))
view(enrich1$data %>% filter(pvalue < 0.05))
# manual labels
enrich1$plot$data$expcat_text <- NA
enrich1$plot$data[enrich1$plot$data$description == "Abnormality of the genitourinary system", ]$expcat_text <- "Abnormality of the genitourinary system"
enrich1$plot$data[enrich1$plot$data$description == "Cerebral palsy", ]$expcat_text <- "Cerebral palsy"
enrich1$plot$data[enrich1$plot$data$description == "Intracranial hemorrhage", ]$expcat_text <- "Intracranial hemorrhage"
enrich1$plot$data[enrich1$plot$data$description == "Behavioral abnormality", ]$expcat_text <- "Behavioral abnormality"
enrich1$plot <- enrich1$plot +
coord_fixed(xlim = c(0, .2), ylim = c(0, .2)) +
ggtitle("Genetic vs. Non-Genetic") +
theme(plot.title = element_text(hjust = 0.5, size = 18))
enrich1$plot
# manual labels
enrich1$plot$data$expcat_text <- NA
enrich1$plot$data[enrich1$plot$data$description == "Abnormality of the genitourinary system", ]$expcat_text <- "Abnormality of the genitourinary system"
enrich1$plot$data[enrich1$plot$data$description == "Intracranial hemorrhage", ]$expcat_text <- "Intracranial hemorrhage"
enrich1$plot$data[enrich1$plot$data$description == "Behavioral abnormality", ]$expcat_text <- "Behavioral abnormality"
enrich1$plot <- enrich1$plot +
coord_fixed(xlim = c(0, .2), ylim = c(0, .2)) +
ggtitle("Genetic vs. Non-Genetic") +
theme(plot.title = element_text(hjust = 0.5, size = 18))
enrich1$plot
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8)
Fig2
dev.off()
?pdf
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8,
encoding='ISOLatin2.enc')
Fig2
dev.off()
## QQ plot
pqq <- gg_qqplot(df_conceptmatch$P_i) +
theme_classic() +
annotate(geom = "text", x = -Inf, y = Inf,
hjust = -0.15, vjust = 1 + 0.15 * 3,
label = Encoding(sprintf("λ = %.2f", inflation(df_conceptmatch$P_i))),
size = 5) +
coord_equal() +
theme(aspect.ratio = 1) +
geom_vline(xintercept = -log10(0.05), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed")
pqq
## QQ plot
pqq <- gg_qqplot(df_conceptmatch$P_i) +
theme_classic() +
annotate(geom = "text", x = -Inf, y = Inf,
hjust = -0.15, vjust = 1 + 0.15 * 3,
label = sprintf("Lambda = %.2f", inflation(df_conceptmatch$P_i)),
size = 5) +
coord_equal() +
theme(aspect.ratio = 1) +
geom_vline(xintercept = -log10(0.05), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed")
pqq
## QQ plot
pqq <- gg_qqplot(df_conceptmatch$P_i) +
theme_classic() +
annotate(geom = "text", x = -Inf, y = Inf,
hjust = -0.15, vjust = 1 + 0.15 * 3,
label = sprintf("λ = %.2f", inflation(df_conceptmatch$P_i)),
size = 5) +
coord_equal() +
theme(aspect.ratio = 1) +
geom_vline(xintercept = -log10(0.05), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed")
pqq
# subset to matched cohort; cross-sectional for now
df_conceptmatch <- df_match1 %>%
distinct(PatientId, group) %>%
left_join(df_concepts[, c("PatientId", "ConceptID", "ConceptDesc")], by = "PatientId") %>%
distinct()
# count by group, then do Fisher's test
df_conceptmatch <- df_conceptmatch %>%
group_by(group) %>%
count(ConceptID) %>%
pivot_wider(names_from = group, values_from = n) %>%
rename(N = `FALSE`, Y = `TRUE`) %>%
replace(is.na(.), 0) %>%
mutate(N_out = max(N)-N, Y_out = max(Y)-Y) %>%
rowwise() %>%
# do Fisher's test
mutate(P = fisher.test(matrix(c(Y, Y_out, N, N_out), nrow = 2, ncol = 2))$p.value,
OR = fisher.test(matrix(c(Y, Y_out, N, N_out), nrow = 2, ncol = 2))$estimate,
CI1 = fisher.test(matrix(c(Y, Y_out, N, N_out), nrow = 2, ncol = 2))$conf.int[[1]],
CI2 = fisher.test(matrix(c(Y, Y_out, N, N_out), nrow = 2, ncol = 2))$conf.int[[2]]) %>%
# adjust for multiple testing, keep original values
ungroup() %>%
mutate(P_i = P) %>%
mutate(P = p.adjust(P, method = "bonferroni"))
## QQ plot
pqq <- gg_qqplot(df_conceptmatch$P_i) +
theme_classic() +
annotate(geom = "text", x = -Inf, y = Inf,
hjust = -0.15, vjust = 1 + 0.15 * 3,
label = sprintf("λ = %.2f", inflation(df_conceptmatch$P_i)),
size = 5) +
coord_equal() +
theme(aspect.ratio = 1) +
geom_vline(xintercept = -log10(0.05), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed")
pqq
## QQ plot
pqq <- gg_qqplot(df_conceptmatch$P_i) +
theme_classic() +
annotate(geom = "text", x = -Inf, y = Inf,
hjust = -0.15, vjust = 1 + 0.15 * 3,
label = sprintf("Lambda = %.2f", inflation(df_conceptmatch$P_i)),
size = 5) +
coord_equal() +
theme(aspect.ratio = 1) +
geom_vline(xintercept = -log10(0.05), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed")
pqq
## QQ plot
pqq <- gg_qqplot(df_conceptmatch$P_i) +
theme_classic() +
annotate(geom = "text", x = -Inf, y = Inf,
hjust = -0.15, vjust = 1 + 0.15 * 3,
label = sprintf("L = %.2f", inflation(df_conceptmatch$P_i)),
size = 5) +
coord_equal() +
theme(aspect.ratio = 1) +
geom_vline(xintercept = -log10(0.05), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed")
pqq
?pdf
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8,
encoding='CP1253.enc')
Fig2
dev.off()
## QQ plot
pqq <- gg_qqplot(df_conceptmatch$P_i) +
theme_classic() +
annotate(geom = "text", x = -Inf, y = Inf,
hjust = -0.15, vjust = 1 + 0.15 * 3,
label = sprintf("λ  = %.2f", inflation(df_conceptmatch$P_i)),
size = 5) +
coord_equal() +
theme(aspect.ratio = 1) +
geom_vline(xintercept = -log10(0.05), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed")
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8,
encoding='CP1253.enc')
Fig2
dev.off()
## QQ plot
pqq <- gg_qqplot(df_conceptmatch$P_i) +
theme_classic() +
annotate(geom = "text", x = -Inf, y = Inf,
hjust = -0.15, vjust = 1 + 0.15 * 3,
label = sprintf("  λ    = %.2f", inflation(df_conceptmatch$P_i)),
size = 5) +
coord_equal() +
theme(aspect.ratio = 1) +
geom_vline(xintercept = -log10(0.05), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed")
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8,
encoding='CP1253.enc')
Fig2
dev.off()
?layout_as_tree
