label = "AUTO", align = "none")
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
cowplot::plot_grid(pheat1,
p_asm,
ncol = 1, nrow = 2,
rel_heights = c(.4, .6),
label = "AUTO", align = "none")
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
cowplot::plot_grid(pheat1,
p_asm,
ncol = 1, nrow = 2,
rel_heights = c(.4, .6),
labels = "AUTO", align = "v")
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
cowplot::plot_grid(pheat1,
p_asm,
ncol = 1, nrow = 2,
rel_heights = c(.33, .66),
labels = "AUTO", align = "v")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig3.pdf",
width = 8,
height = 8)
tmp
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig3.pdf",
width = 8,
height = 8)
tmp
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
tmp <- cowplot::plot_grid(pheat1,
p_asm,
ncol = 1, nrow = 2,
rel_heights = c(.33, .66),
labels = "AUTO", align = "v")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig3.pdf",
width = 8,
height = 8)
tmp
dev.off()
pheat1 <- plong1f$plot$data %>%
ungroup() %>%
# select terms of interest from discovery graph (plong)
filter(term %in% c("HP:0000708", # behav. abnormality
# "HP:0032892", # febrile seizure
"HP:0002719", # recurrent infections
"HP:0002311", # incoordination
"HP:0011968", # feeding difficulties
"HP:0002019", # constipation
"HP:0000939", # osteoporosis
"HP:0002664", # neoplasm incl. neurofibromas
"HP:0012418", # hypoxemia
"HP:0000083" # renal insufficiency
)) %>%
# filter(pvalue < 0.05) %>%
mutate(odds = ifelse(p > 0.05, NA, odds)) %>%
ggplot(aes(x = as.factor(bin),
y = forcats::fct_relevel(description, rev),
fill = log10(odds))) +
geom_tile(color = "black") +
geom_text(aes(label = round(odds, 1)), size = 4) +
theme_classic() +
theme(strip.placement = "outside",
strip.background = element_rect(fill = NA, colour = NA),
panel.spacing = unit(0.2, "cm")) +
ylab("") +
xlab("Median age at encounter (years)") +
scale_fill_gradient2(low = "#00b4fb",
mid = "#F5F5F5",
high = "#ff8422",
midpoint = 0, # adjust based on OR or log OR
na.value = "#F5F5F5",
limits = c(-2, 2),
oob = scales::oob_squish_any)
pheat1 <- plong1f$plot$data %>%
ungroup() %>%
# select terms of interest from discovery graph (plong)
filter(term %in% c("HP:0000708", # behav. abnormality
# "HP:0032892", # febrile seizure
"HP:0002719", # recurrent infections
"HP:0002311", # incoordination
"HP:0011968", # feeding difficulties
"HP:0002019", # constipation
"HP:0000939", # osteoporosis
"HP:0002664", # neoplasm incl. neurofibromas
"HP:0012418", # hypoxemia
"HP:0000083" # renal insufficiency
)) %>%
# filter(pvalue < 0.05) %>%
mutate(odds = ifelse(pvalue > 0.05, NA, odds)) %>%
ggplot(aes(x = as.factor(bin),
y = forcats::fct_relevel(description, rev),
fill = log10(odds))) +
geom_tile(color = "black") +
geom_text(aes(label = round(odds, 1)), size = 4) +
theme_classic() +
theme(strip.placement = "outside",
strip.background = element_rect(fill = NA, colour = NA),
panel.spacing = unit(0.2, "cm")) +
ylab("") +
xlab("Median age at encounter (years)") +
scale_fill_gradient2(low = "#00b4fb",
mid = "#F5F5F5",
high = "#ff8422",
midpoint = 0, # adjust based on OR or log OR
na.value = "#F5F5F5",
limits = c(-2, 2),
oob = scales::oob_squish_any)
pheat1
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
tmp <- cowplot::plot_grid(pheat1,
p_asm,
ncol = 1, nrow = 2,
rel_heights = c(.33, .66),
labels = "AUTO", align = "v")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig3.pdf",
width = 8,
height = 8)
tmp
dev.off()
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig3.pdf",
width = 8,
height = 4)
pheat1
dev.off()
# set legend expression (for subscript)
str_legend <- expression(log['10']*OR)
pheat1 <- plong1f$plot$data %>%
ungroup() %>%
# select terms of interest from discovery graph (plong)
filter(term %in% c("HP:0000708", # behav. abnormality
# "HP:0032892", # febrile seizure
"HP:0002719", # recurrent infections
"HP:0002311", # incoordination
"HP:0011968", # feeding difficulties
"HP:0002019", # constipation
"HP:0000939", # osteoporosis
"HP:0002664", # neoplasm incl. neurofibromas
"HP:0012418", # hypoxemia
"HP:0000083" # renal insufficiency
)) %>%
# filter(pvalue < 0.05) %>%
mutate(odds = ifelse(pvalue > 0.05, NA, odds)) %>%
ggplot(aes(x = as.factor(bin),
y = forcats::fct_relevel(description, rev),
fill = log10(odds))) +
geom_tile(color = "black") +
geom_text(aes(label = round(odds, 1)), size = 4) +
theme_classic() +
theme(strip.placement = "outside",
strip.background = element_rect(fill = NA, colour = NA),
panel.spacing = unit(0.2, "cm")) +
ylab("") +
xlab("Median age at encounter (years)") +
scale_fill_discrete(name = str_legend) +
scale_fill_gradient2(low = "#00b4fb",
mid = "#F5F5F5",
high = "#ff8422",
midpoint = 0, # adjust based on OR or log OR
na.value = "#F5F5F5",
limits = c(-2, 2),
oob = scales::oob_squish_any)
pheat1
pheat1 <- plong1f$plot$data %>%
ungroup() %>%
# select terms of interest from discovery graph (plong)
filter(term %in% c("HP:0000708", # behav. abnormality
# "HP:0032892", # febrile seizure
"HP:0002719", # recurrent infections
"HP:0002311", # incoordination
"HP:0011968", # feeding difficulties
"HP:0002019", # constipation
"HP:0000939", # osteoporosis
"HP:0002664", # neoplasm incl. neurofibromas
"HP:0012418", # hypoxemia
"HP:0000083" # renal insufficiency
)) %>%
# filter(pvalue < 0.05) %>%
mutate(odds = ifelse(pvalue > 0.05, NA, odds)) %>%
ggplot(aes(x = as.factor(bin),
y = forcats::fct_relevel(description, rev),
fill = log10(odds))) +
geom_tile(color = "black") +
geom_text(aes(label = round(odds, 1)), size = 4) +
theme_classic() +
theme(strip.placement = "outside",
strip.background = element_rect(fill = NA, colour = NA),
panel.spacing = unit(0.2, "cm")) +
ylab("") +
xlab("Median age at encounter (years)") +
scale_fill_gradient2(name = str_legend,
low = "#00b4fb",
mid = "#F5F5F5",
high = "#ff8422",
midpoint = 0, # adjust based on OR or log OR
na.value = "#F5F5F5",
limits = c(-2, 2),
oob = scales::oob_squish_any)
pheat1
# set legend expression (for subscript)
str_legend <- expression(log['10']*(OR))
pheat1 <- plong1f$plot$data %>%
ungroup() %>%
# select terms of interest from discovery graph (plong)
filter(term %in% c("HP:0000708", # behav. abnormality
# "HP:0032892", # febrile seizure
"HP:0002719", # recurrent infections
"HP:0002311", # incoordination
"HP:0011968", # feeding difficulties
"HP:0002019", # constipation
"HP:0000939", # osteoporosis
"HP:0002664", # neoplasm incl. neurofibromas
"HP:0012418", # hypoxemia
"HP:0000083" # renal insufficiency
)) %>%
# filter(pvalue < 0.05) %>%
mutate(odds = ifelse(pvalue > 0.05, NA, odds)) %>%
ggplot(aes(x = as.factor(bin),
y = forcats::fct_relevel(description, rev),
fill = log10(odds))) +
geom_tile(color = "black") +
geom_text(aes(label = round(odds, 1)), size = 4) +
theme_classic() +
theme(strip.placement = "outside",
strip.background = element_rect(fill = NA, colour = NA),
panel.spacing = unit(0.2, "cm")) +
ylab("") +
xlab("Median age at encounter (years)") +
scale_fill_gradient2(name = str_legend,
low = "#00b4fb",
mid = "#F5F5F5",
high = "#ff8422",
midpoint = 0, # adjust based on OR or log OR
na.value = "#F5F5F5",
limits = c(-2, 2),
oob = scales::oob_squish_any)
pheat1
# plot
p_asm <- df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
ggplot(aes(x = YearsPrescription,
y = MED_NAME,
fill = log10(OR))) +
geom_tile(color = "black") +
geom_text(aes(label = round(OR, 1)), size = 4) +
theme_classic() +
facet_grid(MED_GROUP~., scales = "free_y", space = "free",
switch = "y", drop = FALSE, margins = FALSE) +
theme(strip.placement = "outside",
strip.background = element_rect(fill = NA, colour = NA),
panel.spacing = unit(0.2, "cm")) +
ylab("") +
xlab("Age at prescription (years)") +
scale_x_discrete(labels = c("0-2", "2-4", "4-8", ">8")) +
scale_fill_gradient2(name = str_legend,
low = "#00b4fb",
mid = "#F5F5F5",
high = "#ff8422",
midpoint = 0, # adjust based on OR or log OR
na.value = "#F5F5F5",
limits = c(-2, 2),
oob = scales::oob_squish_any)
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig3.pdf",
width = 8,
height = 4)
pheat1
dev.off()
### Figure 4: Prescription patterns of genetic vs. non-genetic patients
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig4.pdf",
width = 8,
height = 8)
p_asm
dev.off()
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig3.pdf",
width = qw,
height = 4)
# Fig 3: Longitudinal heatmap of genetic vs. non-genetic patients
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig3.pdf",
width = 12,
height = 4)
pheat1
dev.off()
-log10(df_desc$pvalue)
4*df_desc$pvalue
-log10(df_desc$pvalue) + 7
floor(-log10(df_desc$pvalue), 5)
floor(-log10(df_desc$pvalue))
vec_size <- -log10(df_desc$pvalue)
vec_size[vec_size < 7]
vec_size[vec_size < 7] <- 7
V(g2)[vec_min]$size <- vec_size
E(g2)$arrow.mode <- 2
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "black",
vertex.label.color = "white",
vertex.label.cex = 1,
# vertex.label.dist = 2.5,
edge.arrow.size = .5,
layout = layout_as_tree))) # Reingold-Tilford graph
pqg <- pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
pqg
## note: complete term name labels are just impossible to format with igraph
# V(g2)$label <- NA
# V(g2)[vec_min]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\n", "\n", df_desc$description)
# V(g2)["HP:0003244"]$label <- paste0("\n","\n","\n","\n","\n", "\n", "\n", "\n", "\n", "\t","Penile hypospadia")
# V(g2)["HP:0000028"]$label <- paste0("\n", "\n", "\n", "\n", "\n", "\t","Cryptorchidism")
# V(g2)["HP:0000086"]$label <- paste0("\n", "\n", "\t","Ectopic kidney")
V(g2)$label <- NA
V(g2)[vec_min]$label <- rep(LETTERS)[1:length(V(g2)[vec_min]$label)]
V(g2)$color <- "gray"
V(g2)[vec_min]$color <- "red"
V(g2)$size <- 8
vec_size <- -log10(df_desc$pvalue)
vec_size[vec_size < 7] <- 8
V(g2)[vec_min]$size <- vec_size
E(g2)$arrow.mode <- 2
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "black",
vertex.label.color = "white",
vertex.label.cex = 1,
# vertex.label.dist = 2.5,
edge.arrow.size = .5,
layout = layout_as_tree))) # Reingold-Tilford graph
pqg <- pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
pqg
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8,
encoding = 'CP1253.enc') # to draw Lambda on panel A
Fig2
dev.off()
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "black",
vertex.label.color = "white",
vertex.label.font = 1,
vertex.label.cex = 1,
# vertex.label.dist = 2.5,
edge.arrow.size = .5,
layout = layout_as_tree))) # Reingold-Tilford graph
pqg
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "black",
vertex.label.color = "white",
vertex.label.family = "Helvetica",
vertex.label.font = 1,
vertex.label.cex = 1,
# vertex.label.dist = 2.5,
edge.arrow.size = .5,
layout = layout_as_tree))) # Reingold-Tilford graph
pqg <- pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
pqg
# use ggplotify to get a grob-able object
pqg <- as.ggplot(expression(plot(g2,
vertex.frame.color = "black",
vertex.label.color = "white",
vertex.label.family = "Helvetica",
vertex.label.font = 1,
vertex.label.cex = .9,
# vertex.label.dist = 2.5,
edge.arrow.size = .5,
layout = layout_as_tree))) # Reingold-Tilford graph
pqg <- pqg +
theme(plot.margin = unit(c(-50, -20, -50, -50), "pt"))
pqg
## Figure 2: Genetic vs. Non-Genetic
Fig2 <- cowplot::plot_grid(pqq,
p_forest_nonhpo,
enrich1$forest,
enrich1$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.15), ylim = c(0, 0.15)) +
ylab("Frequency, likely genetic patient encounters") +
xlab("Frequency, non-genetic patients encounters"),
enrich8$plot +
ggtitle("") +
theme_set(theme_classic()) +
coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5)) +
ylab("Frequency, SCN1A patient encounters") +
xlab("Frequency, CDKL5 patient encounters"),
pqg,
nrow = 2, labels = "AUTO", align = "none")
pdf(file = "/Users/cbosselmann/Desktop/GitHub/UMLS-HPO/out/pub_genetic/Fig2.pdf",
width = 12,
height = 8,
encoding = 'CP1253.enc') # to draw Lambda on panel A
Fig2
dev.off()
nrow(df_raw)
length(unique(df_raw$PatientId))
umls_map
## data
# load UMLS concepts
# source: nlm.nih.gov/research/umls/
umls_map <- read.delim("~/Desktop/CCF/EMR cohort study/Surgery cohort/data/MRCONSO.RRF",
sep = "|", header = FALSE)
umls_map <- umls_map %>%
as_tibble() %>%
filter(V2 == "ENG") %>%
distinct(V1, V15) %>%
rename(ConceptID = V1, ConceptDesc = V15)
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
ggplot(aes(x = YearsPrescription,
y = MED_NAME,
fill = log10(OR))) +
geom_tile(color = "black") +
geom_text(aes(label = round(OR, 1)), size = 4) +
theme_classic() +
ylab("") +
xlab("Age at prescription (years)") +
scale_x_discrete(labels = c("0-2", "2-4", "4-8", ">8")) +
scale_fill_gradient2(name = str_legend,
low = "#00b4fb",
mid = "#F5F5F5",
high = "#ff8422",
midpoint = 0, # adjust based on OR or log OR
na.value = "#F5F5F5",
limits = c(-2, 2),
oob = scales::oob_squish_any)
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME))
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
arrange(desc(YearsPrescription))
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
arrange(YearsPrescription)
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
arrange(MED_NAME)
Inf+2.1
?euclidean_dist
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
arrange(MED_NAME) %>%
nest_by(MED_NAME)
?nest_by
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
arrange(MED_NAME) %>%
group_by(MED_NAME) %>%
nest(OR)
?nest
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
arrange(MED_NAME) %>%
group_by(MED_NAME) %>%
nest(YearsPrescription, OR)
tmp <- df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
arrange(MED_NAME) %>%
group_by(MED_NAME) %>%
nest(YearsPrescription, OR)
view(tmp)
View((structure(list(MED_NAME = c("Cannabidiol", "Carbamazepine", "Clonazepam",  "Clonazepam", "Clonazepam", "Diazepam", "Diazepam", "Diazepam",  "Diazepam", "Gabapentin", "Gabapentin", "Gabapentin", "Gabapentin",  "Lacosamide", "Lacosamide", "Lacosamide", "Lacosamide", "Lamotrigine",  "Lamotrigine", "Lamotrigine", "Lamotrigine", "Levetiracetam",  "Levetiracetam", "Levetiracetam", "Levetiracetam", "Lorazepam",  "Lorazepam", "Lorazepam", "Lorazepam", "Midazolam", "Oxcarbazepine",  "Oxcarbazepine", "Oxcarbazepine", "Oxcarbazepine", "Perampanel",  "Perampanel", "Phenytoin", "Phenytoin", "Phenytoin", "Phenytoin",  "Rufinamide", "Rufinamide", "Topiramate", "Topiramate", "Topiramate",  "Topiramate", "Valproic Acid", "Valproic Acid", "Valproic Acid",  "Valproic Acid", "Vigabatrin", "Vigabatrin", "Vigabatrin", "Zonisamide",  "Zonisamide", "Zonisamide", "Zonisamide"), N = c(27L, 7L, 35L,  21L, 13L, 7L, 22L, 24L, 20L, 41L, 5L, 23L, 42L, 19L, 21L, 57L,  221L, 29L, 50L, 133L, 213L, 314L, 320L, 248L, 131L, 206L, 168L,  161L, 224L, 4L, 87L, 165L, 242L, 189L, 22L, 10L, 116L, 49L, 18L,  18L, 14L, 10L, 255L, 183L, 151L, 168L, 22L, 103L, 221L, 158L,  96L, 112L, 36L, 68L, 64L, 103L, 156L), Y = c(131L, 9L, 22L, 26L,  27L, 19L, 29L, 41L, 44L, 110L, 157L, 136L, 147L, 108L, 144L,  259L, 220L, 32L, 193L, 314L, 485L, 840L, 482L, 392L, 211L, 546L,  471L, 368L, 270L, 35L, 153L, 102L, 97L, 108L, 12L, 70L, 102L,  78L, 62L, 35L, 48L, 123L, 571L, 489L, 471L, 271L, 265L, 614L,  536L, 591L, 499L, 238L, 89L, 66L, 147L, 110L, 252L), N_out = c(0L,  0L, 0L, 14L, 22L, 17L, 2L, 0L, 4L, 1L, 37L, 19L, 0L, 202L, 200L,  164L, 0L, 184L, 163L, 80L, 0L, 6L, 0L, 72L, 189L, 18L, 56L, 63L,  0L, 0L, 155L, 77L, 0L, 53L, 0L, 12L, 0L, 67L, 98L, 98L, 54L,  58L, 0L, 72L, 104L, 87L, 199L, 118L, 0L, 63L, 16L, 0L, 76L, 88L,  92L, 53L, 0L), Y_out = c(0L, 0L, 5L, 1L, 0L, 25L, 15L, 3L, 0L,  47L, 0L, 21L, 10L, 151L, 115L, 0L, 39L, 453L, 292L, 171L, 0L,  0L, 358L, 448L, 629L, 0L, 75L, 178L, 276L, 0L, 0L, 51L, 56L,  45L, 58L, 0L, 0L, 24L, 40L, 67L, 75L, 0L, 0L, 82L, 100L, 300L,  349L, 0L, 78L, 23L, 0L, 261L, 410L, 186L, 105L, 142L, 0L), P = c(1,  1, 0.0124756567839108, 0.000844047702916803, 5.87251474623011e-08,  0.304115005308822, 0.0211486437318702, 0.546971027216857, 0.0130478827581549,  6.44531330814908e-05, 3.65119859909867e-35, 2.06289412868679e-05,  0.124333753366344, 3.1476999592161e-17, 2.65285627558192e-28,  1.36207014769964e-79, 9.08304349736553e-12, 0.00348234530600975,  3.1973657968524e-05, 0.607408598795754, 1, 0.00042589399644038,  4.50737322537269e-63, 5.50184234155463e-22, 2.70616736171568e-07,  1.34867534129131e-10, 0.000298597978652372, 0.232187852030386,  1.86328978153265e-54, 1, 1.36066473460006e-46, 0.825399422903227,  4.87994957279205e-27, 0.0957407165622143, 5.93564154525157e-13,  1.78224035201001e-09, 1, 3.02469641616269e-07, 4.14659336854946e-12,  0.00150549615933408, 0.00996703197346482, 5.49745514888309e-39,  1, 4.60116281399901e-06, 4.42635467371655e-12, 8.90396317149001e-07,  2.39761631423103e-21, 5.24806630855728e-82, 1.5991996269809e-11,  6.37183028167947e-22, 6.43360402498183e-13, 1.06238172611615e-31,  0.00113334307408894, 0.000339168543411804, 0.000765848360726152,  1.13310846551357e-05, 1), CI1 = c(0, 0, 0, 2.20095510223563,  9.05648379005566, 0.573373999082596, 0.0181186455436537, 0, 1.30099064989225,  0.00138678624644175, 199.986801954903, 2.31374903583415, 0, 4.38886717046671,  7.01055623164486, 189.12599975433, 0, 0.254803685497752, 1.47678907634244,  0.77851187590383, 0, 3.12424690842035, 0, 0.186353670200633,  0.365632098428908, 11.4771233924382, 1.3887950806477, 0.564415090986211,  0, 0, 69.9897896695539, 0.593514380174544, 0, 0.413447570440271,  0, 15.5106196840361, 0, 2.37914003568226, 4.26436877967157, 1.42438179486911,  1.18756411322678, 147.785782192664, 0, 1.60910357784223, 2.29861041658583,  0.33975250365277, 4.25795516728861, 181.939786497158, 0, 6.02509825618827,  19.472474646723, 0, 0.284140745919827, 0.29430626716998, 1.31499963329698,  0.257428360825907, 0), CI2 = c(Inf, Inf, 0.770978086962425, 757.384124041919,  Inf, 6.3316220814731, 0.901481389917795, 4.4367537706628, Inf,  0.360947556268171, Inf, 12.2266790622958, 1.640259468048, 13.6662787086031,  20.8813459570838, Inf, 0.100750620111493, 0.792901090627318,  3.17320012821171, 1.56209716920973, Inf, Inf, 0.0157870917088505,  0.344093335688699, 0.641865645638803, Inf, 3.13815745900078,  1.1520688378718, 0.0165115239911885, Inf, Inf, 1.47381257115995,  0.0282544491258945, 1.09979533540757, 0.046650908399162, Inf,  Inf, 8.38058308379426, 16.9823525544786, 5.78157512802051, 5.33139233278263,  Inf, Inf, 3.41108644196614, 4.57212576329829, 0.64242481038671,  11.5131437784708, Inf, 0.119013917573804, 17.8218332693237, Inf,  0.0311012364012992, 0.749079770125272, 0.717295405428069, 3.08322639496476,  0.615433497885343, Inf), MED_GROUP = c("Mixed/unknown", "Na",  "GABA", "GABA", "GABA", "GABA", "GABA", "GABA", "GABA", "Ca",  "Ca", "Ca", "Ca", "Na", "Na", "Na", "Na", "Na", "Na", "Na", "Na",  "SV2A", "SV2A", "SV2A", "SV2A", "GABA", "GABA", "GABA", "GABA",  "GABA", "Na", "Na", "Na", "Na", "AMPA", "AMPA", "Na", "Na", "Na",  "Na", "Mixed/unknown", "Mixed/unknown", "Mixed/unknown", "Mixed/unknown",  "Mixed/unknown", "Mixed/unknown", "Mixed/unknown", "Mixed/unknown",  "Mixed/unknown", "Mixed/unknown", "GABA", "GABA", "GABA", "Mixed/unknown",  "Mixed/unknown", "Mixed/unknown", "Mixed/unknown"), freqY = c(0.155952380952381,  0.0107142857142857, 0.0261904761904762, 0.030952380952381, 0.0321428571428571,  0.0226190476190476, 0.0345238095238095, 0.0488095238095238, 0.0523809523809524,  0.130952380952381, 0.186904761904762, 0.161904761904762, 0.175,  0.128571428571429, 0.171428571428571, 0.308333333333333, 0.261904761904762,  0.0380952380952381, 0.229761904761905, 0.373809523809524, 0.577380952380952,  1, 0.573809523809524, 0.466666666666667, 0.251190476190476, 0.65,  0.560714285714286, 0.438095238095238, 0.321428571428571, 0.0416666666666667,  0.182142857142857, 0.121428571428571, 0.11547619047619, 0.128571428571429,  0.0142857142857143, 0.0833333333333333, 0.121428571428571, 0.0928571428571429,  0.0738095238095238, 0.0416666666666667, 0.0571428571428571, 0.146428571428571,  0.679761904761905, 0.582142857142857, 0.560714285714286, 0.322619047619048,  0.31547619047619, 0.730952380952381, 0.638095238095238, 0.703571428571429,  0.594047619047619, 0.283333333333333, 0.105952380952381, 0.0785714285714286,  0.175, 0.130952380952381, 0.3), freqN = c(0.084375, 0.021875,  0.109375, 0.065625, 0.040625, 0.021875, 0.06875, 0.075, 0.0625,  0.128125, 0.015625, 0.071875, 0.13125, 0.059375, 0.065625, 0.178125,  0.690625, 0.090625, 0.15625, 0.415625, 0.665625, 0.98125, 1,  0.775, 0.409375, 0.64375, 0.525, 0.503125, 0.7, 0.0125, 0.271875,  0.515625, 0.75625, 0.590625, 0.06875, 0.03125, 0.3625, 0.153125,  0.05625, 0.05625, 0.04375, 0.03125, 0.796875, 0.571875, 0.471875,  0.525, 0.06875, 0.321875, 0.690625, 0.49375, 0.3, 0.35, 0.1125,  0.2125, 0.2, 0.321875, 0.4875), data = list(structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 16.683582188109), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.179669089324697), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.0575451137181691), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 5.29059775589224), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 7.57271835345182), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 11.8573849808792), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.448768147372073), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 2.15246140186656), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.254332408256258), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.484297335755528), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 2.09114613246897), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 4.41112257898891), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 8.34391432319929), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 2.83015640845059), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 2.45734070608379), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 2.34359591262613), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 3.23855703980463), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.468226114827572), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 6.85389254213238), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 10.2104832118069), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = Inf), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.45893780206203), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(1L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.460120273164673), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(2L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 2.00900083155566), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(3L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = 0.399525590074862), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -1L)), structure(list(YearsPrescription = structure(4L, .Label = c("[0.00274,2]",  "(2,4.24]", "(4.24,7.58]", "(7.58,35.8]"), class = "factor"),      OR = NA_real_), class = c("tbl_df", "tbl", "data.frame"), row.names = c(NA,  -1L)))), class = c("grouped_df", "tbl_df", "tbl", "data.frame" ), row.names = c(NA, -57L), groups = structure(list(MED_NAME = c("Cannabidiol",  "Carbamazepine", "Clonazepam", "Diazepam", "Gabapentin", "Lacosamide",  "Lamotrigine", "Levetiracetam", "Lorazepam", "Midazolam", "Oxcarbazepine",  "Perampanel", "Phenytoin", "Rufinamide", "Topiramate", "Valproic Acid",  "Vigabatrin", "Zonisamide"), .rows = structure(list(1L, 2L, 3:5,      6:9, 10:13, 14:17, 18:21, 22:25, 26:29, 30L, 31:34, 35:36,      37:40, 41:42, 43:46, 47:50, 51:53, 54:57), ptype = integer(0), class = c("vctrs_list_of",  "vctrs_vctr", "list"))), class = c("tbl_df", "tbl", "data.frame" ), row.names = c(NA, -18L), .drop = TRUE)))[[12]][[1]])
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
arrange(MED_NAME) %>%
group_by(MED_NAME) %>%
nest(YearsPrescription, OR)
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
select(MED_NAME, OR, YearsPrescription) %>%
group_by(MED_NAME) %>%
nest(YearsPrescription, OR)
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
select(MED_NAME, OR, YearsPrescription) %>%
group_by(MED_NAME) %>%
nest(YearsPrescription, OR) %>%
summarise(CorMat = cor(data))
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
select(MED_NAME, OR, YearsPrescription) %>%
nest_by(MED_NAME) %>%
summarise(CorMat = cor(data))
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
select(MED_NAME, OR, YearsPrescription) %>%
nest_by(MED_NAME)
df_heatmap %>%
mutate(MED_NAME = str_to_title(MED_NAME)) %>%
select(MED_NAME, OR) %>%
nest_by(MED_NAME) %>%
summarise(CorMat = cor(data))
